{% extends "base.html" %}
{% block title %}è¨˜éŒ²ã®ç¢ºèª{% endblock %}

{% block content %}
<h3 class="mb-4">è¨˜éŒ²ã®ç¢ºèª</h3>

<form method="POST" action="{{ url_for('result') }}">
  <div class="mb-3">
    <label class="form-label">ã‚¹ã‚³ã‚¢</label>
    <input type="number" name="value" class="form-control" id="scoreInput" readonly>
  </div>

  <div class="mb-3">
    <label class="form-label">å’€åš¼å›æ•°</label>
    <input type="number" name="chewCount" class="form-control" id="chewInput" readonly>
  </div>

  <div class="mb-3">
    <label class="form-label">çµŒéæ™‚é–“ï¼ˆç§’ï¼‰</label>
    <input type="number" name="elapsedTime" class="form-control" id="timeInput" readonly>
  </div>

  <div class="mb-3">
    <label class="form-label">ãƒšãƒ¼ã‚¹ï¼ˆå›/åˆ†ï¼‰</label>
    <input type="number" name="pace" class="form-control" id="paceInput" readonly>
  </div>

  <!-- æ˜Ÿè©•ä¾¡ -->
  <div class="mb-3">
    <label class="form-label">ä¸»è¦³çš„ãªè©•ä¾¡</label>
    <div id="starRating" class="text-warning fs-4">
      {% for i in range(1,6) %}
        <i class="bi bi-star" data-value="{{ i }}"></i>
      {% endfor %}
    </div>
    <input type="hidden" name="rating" id="ratingValue" value="0">
  </div>

  <!-- ğŸ§© ãƒŸãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ -->

  <div class="container mt-4">
    <div class="card shadow-sm">
      <div class="card-header text-center">
        <h3>Daily Mission</h3>
      </div>
      <ul class="list-group list-group-flush">
        {% for mission in missions %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span>{{ mission.content }}</span>
            {% if mission.check == True %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" checked disabled>
                <label class="form-check-label text-muted">é”æˆæ¸ˆã¿</label>
              </div>
            {% else %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="mission_ids" value="{{ mission.id }}">
                <label class="form-check-label">é”æˆ</label>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="mt-4">
    <button type="submit" class="btn btn-primary">è¨˜éŒ²ã‚’ç™»éŒ²</button>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">ç ´æ£„</a>
  </div>
</form>

<!-- Bootstrapã‚¢ã‚¤ã‚³ãƒ³ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<script>
// â˜… ã‚¹ã‚³ã‚¢ã‚’JSã® stats ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚»ãƒƒãƒˆ
window.addEventListener("DOMContentLoaded", () => {
  const stats = JSON.parse(localStorage.getItem("latestStats") || "{}");
  if (stats) {
    document.getElementById("scoreInput").value = stats.value ?? 0;
    document.getElementById("chewInput").value = stats.chewCount ?? 0;
    document.getElementById("timeInput").value = stats.elapsedTime ?? 0;
    document.getElementById("paceInput").value = stats.pace ?? 0;
  }

  // â˜… æ˜Ÿè©•ä¾¡
  const stars = document.querySelectorAll("#starRating i");
  stars.forEach(star => {
    star.addEventListener("click", () => {
      const rating = star.dataset.value;
      document.getElementById("ratingValue").value = rating;
      stars.forEach(s => {
        s.classList.toggle("bi-star-fill", s.dataset.value <= rating);
        s.classList.toggle("bi-star", s.dataset.value > rating);
      });
    });
  });
});
</script>
{% endblock %}